---
title: "temp"
author: "Daniel Newman"
date: "12 January 2016"
output: html_document
---








#Participant level N2 Amplitude 

###N2c/i measurement window (100ms) centred on peak amplitude of each INDIVIDUAL PARTICIANT's AVERAGE N2c/i waveforms:
```{r Reshape the participant level data, echo=FALSE, include=FALSE}
#Reshape data_participant_level into long format for modeling with lmw4:
N2_participant_level_long <- melt(data_participant_level, id.vars=c("ID", "Gender", "Group", "Age_B", "DAT1_3_Group"), 
                                  measure.vars=c("N2c_LeftTarget_PA", "N2c_RightTarget_PA", "N2i_LeftTarget_PA", "N2i_RightTarget_PA" ), 
                                  variable.name="Hemifield_by_Hemisphere",
                                  value.name="N2")

#Create seperate target Hemifield and Hemisphere factors
N2_participant_level_long$Hemifield<-revalue(N2_participant_level_long$Hemifield_by_Hemisphere, c("N2c_LeftTarget_PA"="Left","N2i_LeftTarget_PA"="Left", "N2c_RightTarget_PA"="Right", "N2i_RightTarget_PA"="Right"))

N2_participant_level_long$Hemisphere<-revalue(N2_participant_level_long$Hemifield_by_Hemisphere, c("N2c_LeftTarget_PA"="Contralateral","N2i_LeftTarget_PA"="Ipsilateral", "N2c_RightTarget_PA"="Contralateral", "N2i_RightTarget_PA"="Ipsilateral"))

#Histogram of participant's N2c scores by group and Hemifield 
N2_participant_level_long$Group_by_Hemifield_By_Hemisphere<-interaction(N2_participant_level_long$Group,N2_participant_level_long$Hemifield, N2_participant_level_long$Hemisphere)
ggplot(N2_participant_level_long, aes(N2))  + geom_histogram(aes(y=..count..), colour="black", fill="white") + facet_wrap(~ Group_by_Hemifield_By_Hemisphere, ncol = 2)


# #Find N2 Outliers 
# N2_participant_level_long$N2.Z<-scale(N2_participant_level_long$N2)
# hist(N2_participant_level_long$N2.Z)
# #Check which participants have outlier N2s
# N2_participant_level_long[!abs(N2_participant_level_long$N2.Z)<3,]
# 
# #Remove N2s Outliers 
# N2_participant_level_long<-N2_participant_level_long[abs(N2_participant_level_long$N2.Z)<3,]
# 	hist(N2_participant_level_long$N2.Z)

source("summarySE.R") 
source("summarySEwithin.R") #function to calculate Std.Er of mean
source("normDataWithin.R")
plotdata <- summarySEwithin(N2_participant_level_long, measurevar="N2", withinvars=c("Hemisphere","Hemifield"), betweenvars="Group", idvar="ID")
N2_ParticipantLevelBarPlot_Group<-ggplot(plotdata, aes(x=Hemisphere, y=N2, fill=Hemifield)) +
    geom_bar(position=position_dodge(.9), colour="Black", stat="identity") + 
    geom_errorbar(position=position_dodge(.9), width=.3, aes(ymin=N2-se, ymax=N2+se)) + #can change "se" to "ci" if I want to use 95%ci instead
    geom_hline(yintercept=0) +  coord_cartesian(ylim = c(1, -2.7)) +
    xlab("Hemisphere") + ylab("Absolute N2 Amplitude (uV)") +
    theme(axis.title.x = element_text(face="bold", size=12),
          axis.text.x  = element_text(face="bold", angle=0,  size=12)) +
    theme(axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=12)) +
    theme(legend.title = element_text(size=11, face="bold")) +
    theme(legend.text = element_text(size = 11, face = "bold")) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
          panel.background = element_blank(), axis.line = element_line(colour = "black")) + facet_wrap(~ Group)

load(file = "StimLockedN2_Plot_Group.gg")


```


```{r, message=FALSE, warning=FALSE}
#model N2 as a function of Group, Hemifield, and Hemisphere
N2_random_intercepts_only<-lmer(N2 ~ 1 + (1 | ID/Hemisphere) +(1|Hemifield), data = N2_participant_level_long, REML=FALSE, na.action = na.omit)
#main effects
N2_Group<-update(N2_random_intercepts_only, .~. + Group)
N2_Hemifield<-update(N2_Group, .~. + Hemifield)
N2_Hemisphere<-update(N2_Hemifield, .~. + Hemisphere)
N2_Group_by_Hemifield<-update(N2_Hemisphere, .~. + Group*Hemifield)
N2_Group_by_Hemisphere<-update(N2_Group_by_Hemifield, .~. + Group*Hemisphere)
N2_Hemifield_by_Hemisphere<-update(N2_Group_by_Hemisphere, .~. + Hemifield*Hemisphere)
N2_Group_by_Hemifield_By_Hemisphere<-update(N2_Hemifield_by_Hemisphere, .~. + Group*Hemifield*Hemisphere)

anova(N2_random_intercepts_only, N2_Group, N2_Hemifield, N2_Hemisphere, N2_Group_by_Hemifield, N2_Group_by_Hemisphere, N2_Hemifield_by_Hemisphere,N2_Group_by_Hemifield_By_Hemisphere)

```

###So there is a significant Group x Hemifield x Hemisphere interaction in the N2 data

**Plot it:**

```{r, message=FALSE, warning=FALSE}
# source("multiplot.R")
# multiplot(StimLockedN2_Plot_Group, N2_ParticipantLevelBarPlot_Group, cols = 1)

StimLockedN2_Plot_Group

N2_ParticipantLevelBarPlot_Group


```

###Break down the signifiant N2 Group x Hemifield x Hemisphere interaction
```{r, message=FALSE, warning=FALSE}
#########Break down the signifiant Hemifield by Hemisphere by group interaction

#look at the effect of Hemisphere for ADHD only  - shows no significant hemispheric asymmetry in pre-target alpha in those with ADHD 
N2_participant_level_long_ADHD<-N2_participant_level_long[N2_participant_level_long$Group=="ADHD",] 

baseline_ADHD<-lmer(N2 ~ 1  + (1 | ID/Hemisphere) +(1|Hemifield), data = N2_participant_level_long_ADHD, REML=FALSE, na.action = na.omit)
N2_Hemifield_ADHD<-update(baseline_ADHD, .~. + Hemifield)
N2_Hemisphere_ADHD<-update(N2_Hemifield_ADHD, .~. + Hemisphere)  
N2_Hemifield_by_Hemisphere_ADHD<-update(N2_Hemisphere_ADHD, .~. +  Hemifield*Hemisphere) 
anova(baseline_ADHD,N2_Hemifield_ADHD,N2_Hemisphere_ADHD,N2_Hemifield_by_Hemisphere_ADHD)

require(effects)
plot(allEffects(N2_Hemifield_by_Hemisphere_ADHD), multiline=F)

#look at the effect of Hemisphere for Control only  - shows no significant hemispheric asymmetry in pre-target alpha in those with Control 
N2_participant_level_long_Control<-N2_participant_level_long[N2_participant_level_long$Group=="Control",] 

baseline<-lmer(N2 ~ 1  + (1 | ID/Hemisphere) +(1|Hemifield), data = N2_participant_level_long_Control , REML=FALSE, na.action = na.omit)
N2_Hemifield_Control<-update(baseline, .~. + Hemifield)
N2_Hemisphere_Control<-update(N2_Hemifield_Control, .~. + Hemisphere)  
N2_Hemifield_by_Hemisphere_Control<-update(N2_Hemisphere_Control, .~. +  Hemifield*Hemisphere) 
anova(baseline,N2_Hemifield_Control,N2_Hemisphere_Control,N2_Hemifield_by_Hemisphere_Control)

plot(allEffects(N2_Hemifield_by_Hemisphere_Control), multiline=F)


##### SHOULD ALSO TRY TRADITIONAL t-tests FOR THE ABOVE ^
# options(digits = 3)
# ezANOVA(data = N2_participant_level_long, dv = .(N2), wid = .(ID),  between = .(Group), within = .(Hemifield, Hemisphere), type = 3, detailed = TRUE, return_aov=T)
# options(digits = 7)
# 
# boot<-ezBoot(data = N2_participant_level_long, dv = .(N2), wid = .(ID),  between = .(Group), within = .(Hemifield, Hemisphere), resample_within=F)
# 
# ezPlot2(boot, x=Hemisphere, split=Hemifield, col=Group)
# 
# 
# ezPerm(data = N2_participant_level_long, dv = .(N2), wid = .(ID),  between = .(Group), within = .(Hemifield, Hemisphere), perms = 1000)




#Try a boxplot
dateBoxplot <- ggplot(N2_participant_level_long, aes(Hemifield, abs(N2), colour = Hemisphere))
dateBoxplot + geom_boxplot() + facet_wrap(~Group) #+ geom_point( alpha=0.9)


##Check assumptions for  model by plotting residuals:
residuals_N2_Group_by_Hemifield_By_Hemisphere=residuals(N2_Group_by_Hemifield_By_Hemisphere)
plot(residuals_N2_Group_by_Hemifield_By_Hemisphere)
qqnorm(residuals_N2_Group_by_Hemifield_By_Hemisphere)
qqline(residuals_N2_Group_by_Hemifield_By_Hemisphere)
hist(residuals_N2_Group_by_Hemifield_By_Hemisphere)

##Test N2c only
N2c<-N2_participant_level_long[N2_participant_level_long$Hemisphere=="Contralateral",]
N2_random_intercepts_only<-lmer(N2 ~ 1 + (1 | Group/ID) +(1|Hemifield), data = N2c, REML=FALSE, na.action = na.omit)
N2_Group<-update(N2_random_intercepts_only, .~. + Group)
N2_Hemifield<-update(N2_Group, .~. + Hemifield)
N2_Group_by_Hemifield<-update(N2_Hemifield, .~. + Group*Hemifield)

anova(N2_random_intercepts_only, N2_Group, N2_Hemifield, N2_Group_by_Hemifield)


```






####################################################################################################################################
####################################################################################################################################
####################################################################################################################################
####################################################################################################################################
####################################################################################################################################



#N2c_GA vs N2i_GA x Hemifield x Group - (using N2c/i measurement window based on GRAND AVERAGE N2c/i) 

```{r, echo=FALSE, message=FALSE}

#Make Hemisphere a factor:
DF<-data.frame(data$ID, data$ITI, data$Hemifield, data$N2c_GA,data$N2i_GA, data$Trial, data$Blinkneg100_450, data$LeftFixBreakneg100_450, data$RightFixBreakneg100_450, data$Art_neg100_450, data$BothFixBreakneg100_450, data$Group)

names(DF) <- c("ID",  "ITI",	"Hemifield","N2c_GA","N2i_GA","Trial","Blinkneg100_450", 
               "LeftFixBreakneg100_450", "RightFixBreakneg100_450", "Art_neg100_450", "BothFixBreakneg100_450", "Group")



DF$contralateral<-rep("contralateral",length(DF[,1]))
DF$ipsilateral<-rep("ipsilateral",length(DF[,1]))               
DF_contralateral<-subset(DF, select=c(ID, ITI, Hemifield,N2c_GA,contralateral,Trial,Blinkneg100_450, 
                                      LeftFixBreakneg100_450, RightFixBreakneg100_450, Art_neg100_450, BothFixBreakneg100_450,Group))
DF_ipsilateral<-subset(DF, select=c(ID, ITI, Hemifield,N2i_GA,ipsilateral,Trial,Blinkneg100_450, 
                                    LeftFixBreakneg100_450, RightFixBreakneg100_450, Art_neg100_450, BothFixBreakneg100_450,Group))

names(DF_contralateral)[names(DF_contralateral)=="contralateral"] <- "Hemisphere"
names(DF_ipsilateral)[names(DF_ipsilateral)=="ipsilateral"] <- "Hemisphere"
names(DF_contralateral)[names(DF_contralateral)=="N2c_GA"] <- "N2"
names(DF_ipsilateral)[names(DF_ipsilateral)=="N2i_GA"] <- "N2"
DF<-rbind(DF_contralateral,DF_ipsilateral)
rm(DF_contralateral,DF_ipsilateral)
DF$Hemisphere <- factor(DF$Hemisphere)

DF<-DF[!DF$Blinkneg100_450 & !DF$LeftFixBreakneg100_450 & !DF$RightFixBreakneg100_450 & !DF$Art_neg100_450 & !DF$BothFixBreakneg100_450, ]


DF$IDbyHemifieldbyITIbyHemispherebyHemisphere<-interaction(DF$ID, DF$Hemifield, DF$ITI, DF$Hemisphere)
#calculate mean and sd 
m <- tapply(DF$N2,DF$IDbyHemifieldbyITIbyHemisphere,mean)
s <- sqrt(tapply(DF$N2,DF$IDbyHemifieldbyITIbyHemisphere,var))
#calculate N2.Z and save it inside data.frame
DF$N2.Z <- (DF$N2-m[DF$IDbyHemifieldbyITIbyHemisphere])/s[DF$IDbyHemifieldbyITIbyHemisphere]
#check that Z scores have mean=0 and std=1 
N2.Z_checker <- ddply(DF, c("ID", "Hemifield", "ITI", "Hemisphere"), summarise,
                      N    = length(N2.Z ),
                      mean = round(mean(N2.Z )),
                      sd   = sd(N2.Z ),
                      se   = sd / sqrt(N))

##Remove trials where absolute N2.Z>3 (i.e. remove outlier N2s)
DF<-DF[!abs(DF$N2.Z)>3,]

# hist_N2<-ggplot(DF, aes(N2))  + geom_histogram(aes(y=..count..), colour="black", fill="white") 
# hist_N2 + facet_wrap(~ ID)
# hist(DF$N2)

###Run the mixed model  
N2_random_intercepts_only<-lmer(N2 ~ 1 + (1 | ID/Hemisphere) +(1|ITI) + (1|Hemifield) + (1|Trial), data = DF, REML=FALSE, na.action = na.omit)
N2_Group<-update(N2_random_intercepts_only, .~. + Group)
N2_Hemifield<-update(N2_Group, .~. + Hemifield)
N2_Hemisphere<-update(N2_Hemifield, .~. + Hemisphere)
N2_HemifieldbyGroup<-update(N2_Hemisphere, .~. + Hemifield:Group)
N2_HemispherebyGroup<-update(N2_HemifieldbyGroup, .~. + Hemisphere:Group)
N2_HemifieldbyHemisphere<-update(N2_HemispherebyGroup, .~. + Hemisphere:Hemifield)
N2_HemifieldbyGroupbyHemisphere<-update(N2_HemifieldbyHemisphere, .~. + Hemifield:Group:Hemisphere)

anova(N2_random_intercepts_only, N2_Group, N2_Hemifield, N2_Hemisphere, N2_HemifieldbyGroup, N2_HemispherebyGroup, N2_HemifieldbyHemisphere, N2_HemifieldbyGroupbyHemisphere)


#Look at the main effect of Hemisphere:
contrast.matrix_N2_Hemisphere<-rbind("LeftHemisphere vs RightHemisphere"  =c(0,0,0,1))
summary(glht(N2_Hemisphere, contrast.matrix_N2_Hemisphere))


##############Break down the Group x Hemisphere x Hemifield interaction##############
#Test for Group*Hemisphere interaction for Left-targets only   -
baseline_LTonly<-lmer(N2 ~ 1 +  (1 | ID/Hemisphere) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Left",], REML=FALSE, na.action = na.omit)
Group_LTonly<-update(baseline_LTonly , .~. + Group)
Hemisphere_LTonly<-update(Group_LTonly , .~. + Hemisphere)
GroupbyHemisphere_LTonly<-update(Hemisphere_LTonly , .~. + Group*Hemisphere)
anova(baseline_LTonly,Group_LTonly,Hemisphere_LTonly,GroupbyHemisphere_LTonly)

#Test for  Group*Hemisphere for Right-targets only   -
baseline_RTonly<-lmer(N2 ~ 1 +  (1 | ID/Hemisphere) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Right",], REML=FALSE, na.action = na.omit)
Group_RTonly<-update(baseline_RTonly , .~. + Group)
Hemisphere_RTonly<-update(Group_RTonly , .~. + Hemisphere)
GroupbyHemisphere_RTonly<-update(Hemisphere_RTonly , .~. + Group*Hemisphere)
anova(baseline_RTonly,Group_RTonly,Hemisphere_RTonly,GroupbyHemisphere_RTonly)



#Test for Group*TargetSide interaction for contralateral Hemisphere only   -
baseline_N2cOnly<-lmer(N2 ~ 1 +  (1 | ID) +(1|ITI)+(1|Hemifield)  + (1|Trial), data = DF[DF$Hemisphere=="contralateral",], REML=FALSE, na.action = na.omit)
Group_N2cOnly<-update(baseline_N2cOnly , .~. + Group)
Hemifield_N2cOnly<-update(Group_N2cOnly , .~. + Hemifield)
GroupbyHemifield_N2cOnly<-update(Hemifield_N2cOnly , .~. + Group*Hemifield)
anova(baseline_N2cOnly,Group_N2cOnly,Hemifield_N2cOnly,GroupbyHemifield_N2cOnly)

#Test for Group*TargetSide interaction for ipsilateral Hemisphere only   -
baseline_N2iOnly<-lmer(N2 ~ 1 +  (1 | ID) +(1|ITI) +(1|Hemifield) + (1|Trial), data = DF[DF$Hemisphere=="ipsilateral",], REML=FALSE, na.action = na.omit)
Group_N2iOnly<-update(baseline_N2iOnly , .~. + Group)
Hemifield_N2iOnly<-update(Group_N2iOnly , .~. + Hemifield)
GroupbyHemifield_N2iOnly<-update(Hemifield_N2iOnly , .~. + Group*Hemifield)
anova(baseline_N2iOnly,Group_N2iOnly,Hemifield_N2iOnly,GroupbyHemifield_N2iOnly)


baseline_LTonly<-lmer(N2 ~ 1 +  (1 | ID/Hemisphere) + (1|Hemifield) +(1|ITI)  + (1|Trial), data = DF[DF$Group=="Controls",], REML=FALSE, na.action = na.omit)
Hemifield_LTonly<-update(baseline_LTonly , .~. + Hemifield)
Hemisphere_LTonly<-update(Hemifield_LTonly , .~. + Hemisphere)
GroupbyHemisphere_LTonly<-update(Hemisphere_LTonly , .~. + Hemifield*Hemisphere)
anova(baseline_LTonly,Hemifield_LTonly,Hemisphere_LTonly,GroupbyHemisphere_LTonly)

#Test for  Group*Hemisphere for Right-targets only   -
baseline_RTonly<-lmer(N2 ~ 1 +  (1 | ID/Hemisphere) +(1|ITI) + (1|Hemifield) + (1|Trial), data = DF[DF$Group=="ADHD",], REML=FALSE, na.action = na.omit)
Hemifield_RTonly<-update(baseline_RTonly , .~. + Hemifield)
Hemisphere_RTonly<-update(Hemifield_RTonly , .~. + Hemisphere)
GroupbyHemisphere_RTonly<-update(Hemisphere_RTonly , .~. + Hemifield*Hemisphere)
anova(baseline_RTonly,Hemifield_RTonly,Hemisphere_RTonly,GroupbyHemisphere_RTonly)








#look at Group*Hemisphere interaction for Left-targets only   -
summary(glht(lmer(N2 ~ Group*Hemisphere  +  (1 | ID/Hemisphere) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Left",], REML=FALSE, na.action = na.omit)))
#look at  Group*Hemisphere for Right-targets only   -
summary(glht(lmer(N2 ~ Group*Hemisphere  +  (1 | ID/Hemisphere) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Right",], REML=FALSE, na.action = na.omit)))


#look at the effect of Group for Left target N2c_GA  -
summary(glht(lmer(N2 ~ Group + (1 | ID) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Left" & DF$Hemisphere=="contralateral",], REML=FALSE, na.action = na.omit)))
#look at the effect of Group for Left target N2i_GA  -
summary(glht(lmer(N2 ~ Group + (1 | ID) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Left" & DF$Hemisphere=="ipsilateral",], REML=FALSE, na.action = na.omit)))
#look at the effect of Group for Contralateral Hemisphere for Right-targets only  
summary(glht(lmer(N2 ~ Group + (1 | ID) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Right" & DF$Hemisphere=="contralateral",], REML=FALSE, na.action = na.omit)))
#look at the effect of Group for Left target N2i_GA  -
summary(glht(lmer(N2 ~ Group + (1 | ID) +(1|ITI)  + (1|Trial), data = DF[DF$Hemifield=="Right" & DF$Hemisphere=="ipsilateral",], REML=FALSE, na.action = na.omit)))


# plotdata <- summarySEwithin(DF, measurevar="N2", withinvars=c("Hemisphere", "Hemifield"), betweenvars="Group", idvar="ID")
#     ggplot(plotdata, aes(x=Hemisphere, y=N2, fill=Group)) +
#     geom_bar(position=position_dodge(.9), colour="Black", stat="identity") + 
#     geom_errorbar(position=position_dodge(.9), width=.3, aes(ymin=N2-se, ymax=N2+se)) + #can change "se" to "ci" if I want to use 95%ci instead
#     geom_hline(yintercept=0) +  coord_cartesian(ylim = c(1, -2.7)) +
#     xlab("Hemisphere") + ylab("Absolute N2 Amplitude (uV)") +
#     theme(axis.title.x = element_text(face="bold", size=12),
#           axis.text.x  = element_text(face="bold", angle=0,  size=12)) +
#     theme(axis.title.y = element_text(face="bold", size=12),
#           axis.text.y  = element_text(angle=0, vjust=0.5, size=12)) +
#     theme(legend.title = element_text(size=11, face="bold")) +
#     theme(legend.text = element_text(size = 11, face = "bold")) +
#     theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
#           panel.background = element_blank(), axis.line = element_line(colour = "black")) + facet_wrap(~ Hemifield)


#######TRY CALCULATING N2c_GA minus N2i_GA TO BREAK THIS ^ INTERACTION DOWN ^ 


#So plot the significant Group x Hemifield x Hemisphere interaction:

require(effects)
plot(allEffects(N2_HemifieldbyGroupbyHemisphere), multiline=T,x.var="Hemisphere", z.var="Hemifield")


source("summarySE.R") 
source("summarySEwithin.R") #function to calculate Std.Er of mean
source("normDataWithin.R")
plotdata <- summarySEwithin(DF, measurevar="N2", withinvars=c("Hemisphere","Hemifield"), betweenvars="Group", idvar="ID")
# plotdata$N2<-abs(plotdata$N2)

N2_BarPlot_Group<-ggplot(plotdata, aes(x=Hemisphere, y=N2, fill=Hemifield)) +
    geom_bar(position=position_dodge(.9), colour="Black", stat="identity") + 
    geom_errorbar(position=position_dodge(.9), width=.3, aes(ymin=N2-se, ymax=N2+se)) + #can change "se" to "ci" if I want to use 95%ci instead
    geom_hline(yintercept=0) +  coord_cartesian(ylim = c(1, -2.7)) +
    xlab("Hemisphere") + ylab("Absolute N2 Amplitude (uV)") +
    theme(axis.title.x = element_text(face="bold", size=12),
          axis.text.x  = element_text(face="bold", angle=0,  size=12)) +
    theme(axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=12)) +
    theme(legend.title = element_text(size=11, face="bold")) +
    theme(legend.text = element_text(size = 11, face = "bold")) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
          panel.background = element_blank(), axis.line = element_line(colour = "black")) + facet_wrap(~ Group)

load(file = "StimLockedN2_Plot_Group.gg")


N2_BarPlot_Hemisphere<-ggplot(plotdata, aes(x=Group, y=N2, fill=Hemifield)) +
    geom_bar(position=position_dodge(.9), colour="Black", stat="identity") + 
    geom_errorbar(position=position_dodge(.9), width=.3, aes(ymin=N2-se, ymax=N2+se)) + #can change "se" to "ci" if I want to use 95%ci instead
    geom_hline(yintercept=0) +  coord_cartesian(ylim = c(-2.7, 1)) +
    xlab("Group") + ylab("Absolute N2 Amplitude (uV)") +
    theme(axis.title.x = element_text(face="bold", size=12),
          axis.text.x  = element_text(face="bold", angle=0,  size=12)) +
    theme(axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=12)) +
    theme(legend.title = element_text(size=11, face="bold")) +
    theme(legend.text = element_text(size = 11, face = "bold")) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
          panel.background = element_blank(), axis.line = element_line(colour = "black")) + facet_wrap(~ Hemisphere)

load(file = "StimLockedN2_Plot_Hemisphere.gg")

source("multiplot.R")

# multiplot(StimLockedN2_Plot_Group, N2_BarPlot_Group, StimLockedN2_Plot_Hemisphere, N2_BarPlot_Hemisphere, cols = 2)

multiplot(StimLockedN2_Plot_Group, N2_BarPlot_Group, cols = 2)

##Check assumptions for  model by plotting residuals:
residuals_N2_HemifieldbyGroupbyHemisphere=residuals(N2_HemifieldbyGroupbyHemisphere)
plot(residuals_N2_HemifieldbyGroupbyHemisphere)
qqnorm(residuals_N2_HemifieldbyGroupbyHemisphere)
qqline(residuals_N2_HemifieldbyGroupbyHemisphere)
hist(residuals_N2_HemifieldbyGroupbyHemisphere)


## NO EFFECTS OF TOT on N2:
##Check for TOT effects:
N2_TOT<-update(N2_HemifieldbyGroupbyHemisphere, .~. + Trial)
N2_GroupbyTOT<-update(N2_TOT, .~. + Trial*Group)
N2_HemifieldbyTOT<-update(N2_GroupbyTOT, .~. + Trial*Hemifield)
N2_HemispherebyTOT<-update(N2_HemifieldbyTOT, .~. + Trial*Hemisphere)
N2_HemifieldbyGroupbyTOT<-update(N2_HemispherebyTOT, .~. + Trial*Hemifield*Group)
N2_HemispherebyGroupbyTOT<-update(N2_HemifieldbyGroupbyTOT, .~. + Trial*Hemisphere*Group)
N2_HemifieldbyHemispherebyTOT<-update(N2_HemispherebyGroupbyTOT, .~. + Trial*Hemisphere*Hemifield)
N2_HemifieldbyGroupbyHemispherebyTOT<-update(N2_HemifieldbyHemispherebyTOT, .~. + Trial*Hemisphere*Hemifield*Group)
anova(N2_HemifieldbyGroupbyHemisphere, N2_TOT, N2_GroupbyTOT, N2_HemifieldbyTOT,N2_HemispherebyTOT,N2_HemifieldbyGroupbyTOT,N2_HemispherebyGroupbyTOT,N2_HemifieldbyHemispherebyTOT,N2_HemifieldbyGroupbyHemispherebyTOT)

```


#Participant level N2 Amplitude analysis - using GRAND AVERAGE to define N2c/i measurement window
```{r, message=FALSE}
#Reshape data_participant_level into long format for modeling with lmw4:
N2_participant_level_long <- melt(data_participant_level, id.vars=c("ID", "Gender", "Group", "Age_B", "DAT1_3_Group"), 
                                  measure.vars=c("N2c_LeftTarget_GA", "N2c_RightTarget_GA", "N2i_LeftTarget_GA", "N2i_RightTarget_GA" ), 
                                  variable.name="Hemifield_by_Hemisphere",
                                  value.name="N2")

#Create seperate target Hemifield and Hemisphere factors
N2_participant_level_long$Hemifield<-revalue(N2_participant_level_long$Hemifield_by_Hemisphere, c("N2c_LeftTarget_GA"="Left","N2i_LeftTarget_GA"="Left", "N2c_RightTarget_GA"="Right", "N2i_RightTarget_GA"="Right"))

N2_participant_level_long$Hemisphere<-revalue(N2_participant_level_long$Hemifield_by_Hemisphere, c("N2c_LeftTarget_GA"="Contralateral","N2i_LeftTarget_GA"="Ipsilateral", "N2c_RightTarget_GA"="Contralateral", "N2i_RightTarget_GA"="Ipsilateral"))

#Histogram of participant's N2c scores by group and Hemifield 
N2_participant_level_long$Group_by_Hemifield_By_Hemisphere<-interaction(N2_participant_level_long$Group,N2_participant_level_long$Hemifield, N2_participant_level_long$Hemisphere)
ggplot(N2_participant_level_long, aes(N2))  + geom_histogram(aes(y=..count..), colour="black", fill="white") + facet_wrap(~ Group_by_Hemifield_By_Hemisphere, ncol = 2)

# #Find N2 Outliers 
# N2_participant_level_long$N2.Z<-scale(N2_participant_level_long$N2)
# hist(N2_participant_level_long$N2.Z)
# #Check which participants have outlier N2s
# N2_participant_level_long[!abs(N2_participant_level_long$N2.Z)<3,]
# 
# #Remove N2s Outliers 
# N2_participant_level_long<-N2_participant_level_long[abs(N2_participant_level_long$N2.Z)<3,]
# 	hist(N2_participant_level_long$N2.Z)


#model N2 as a function of Group, Hemifield, and Hemisphere
N2_random_intercepts_only<-lmer(N2 ~ 1 + (1 | ID/Hemisphere) +(1|Hemifield), data = N2_participant_level_long, REML=FALSE, na.action = na.omit)
#main effects
N2_Group<-update(N2_random_intercepts_only, .~. + Group)
N2_Hemifield<-update(N2_Group, .~. + Hemifield)
N2_Hemisphere<-update(N2_Hemifield, .~. + Hemisphere)
#two way interactions
N2_Group_by_Hemifield<-update(N2_Hemisphere, .~. + Group*Hemifield)
N2_Group_by_Hemisphere<-update(N2_Group_by_Hemifield, .~. + Group*Hemisphere)
N2_Hemifield_by_Hemisphere<-update(N2_Group_by_Hemisphere, .~. + Hemifield*Hemisphere)
#three way interaciton 
N2_Group_by_Hemifield_By_Hemisphere<-update(N2_Hemifield_by_Hemisphere, .~. + Group*Hemifield*Hemisphere)

anova(N2_random_intercepts_only, N2_Group, N2_Hemifield, N2_Hemisphere, N2_Group_by_Hemifield, N2_Group_by_Hemisphere, N2_Hemifield_by_Hemisphere,N2_Group_by_Hemifield_By_Hemisphere)

#########Break down the signifiant Hemifield by Hemisphere by group interaction

#look at the effect of Hemisphere for ADHD only  - shows no significant hemispheric asymmetry in pre-target alpha in those with ADHD 
N2_participant_level_long_ADHD<-N2_participant_level_long[N2_participant_level_long$Group=="ADHD",] 

baseline<-lmer(N2 ~ 1  + (1 | ID/Hemisphere) +(1|Hemifield), data = N2_participant_level_long_ADHD , REML=FALSE, na.action = na.omit)
N2_Hemifield_ADHD<-update(baseline, .~. + Hemifield)
N2_Hemisphere_ADHD<-update(N2_Hemifield_ADHD, .~. + Hemisphere)  
N2_Hemifield_by_Hemisphere_ADHD<-update(N2_Hemisphere_ADHD, .~. +  Hemifield*Hemisphere) 
anova(baseline,N2_Hemifield_ADHD,N2_Hemisphere_ADHD,N2_Hemifield_by_Hemisphere_ADHD)

require(effects)
plot(allEffects(N2_Hemifield_by_Hemisphere_ADHD), multiline=F)

#look at the effect of Hemisphere for Control only  - shows no significant hemispheric asymmetry in pre-target alpha in those with Control 
#look at the effect of Hemisphere for Control only  - shows no significant hemispheric asymmetry in pre-target alpha in those with Control 
N2_participant_level_long_Control<-N2_participant_level_long[N2_participant_level_long$Group=="Control",] 

baseline<-lmer(N2 ~ 1  + (1 | ID/Hemisphere) +(1|Hemifield), data = N2_participant_level_long_Control , REML=FALSE, na.action = na.omit)
N2_Hemifield_Control<-update(baseline, .~. + Hemifield)
N2_Hemisphere_Control<-update(N2_Hemifield_Control, .~. + Hemisphere)  
N2_Hemifield_by_Hemisphere_Control<-update(N2_Hemisphere_Control, .~. +  Hemifield*Hemisphere) 
anova(baseline,N2_Hemifield_Control,N2_Hemisphere_Control,N2_Hemifield_by_Hemisphere_Control)

plot(allEffects(N2_Hemifield_by_Hemisphere_Control), multiline=F)


##### SHOULD ALSO TRY TRADITIONAL t-tests FOR THE ABOVE ^
options(digits = 3)
ezANOVA(data = N2_participant_level_long, dv = .(N2), wid = .(ID),  between = .(Group), within = .(Hemifield, Hemisphere), type = 3, detailed = TRUE, return_aov=T)
options(digits = 7)

boot<-ezBoot(data = N2_participant_level_long, dv = .(N2), wid = .(ID),  between = .(Group), within = .(Hemifield, Hemisphere), resample_within=F)

ezPlot2(boot, x=Hemisphere, split=Hemifield, col=Group)


ezPerm(data = N2_participant_level_long, dv = .(N2), wid = .(ID),  between = .(Group), within = .(Hemifield, Hemisphere), perms = 1000)




source("summarySE.R") 
source("summarySEwithin.R") #function to calculate Std.Er of mean
source("normDataWithin.R")
plotdata <- summarySEwithin(N2_participant_level_long, measurevar="N2", withinvars=c("Hemisphere","Hemifield"), betweenvars="Group", idvar="ID")
N2_ParticipantLevelBarPlot_Group<-ggplot(plotdata, aes(x=Hemisphere, y=N2, fill=Hemifield)) +
    geom_bar(position=position_dodge(.9), colour="Black", stat="identity") + 
    geom_errorbar(position=position_dodge(.9), width=.3, aes(ymin=N2-se, ymax=N2+se)) + #can change "se" to "ci" if I want to use 95%ci instead
    geom_hline(yintercept=0) +  coord_cartesian(ylim = c(1, -2.7)) +
    xlab("Hemisphere") + ylab("Absolute N2 Amplitude (uV)") +
    theme(axis.title.x = element_text(face="bold", size=12),
          axis.text.x  = element_text(face="bold", angle=0,  size=12)) +
    theme(axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=12)) +
    theme(legend.title = element_text(size=11, face="bold")) +
    theme(legend.text = element_text(size = 11, face = "bold")) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
          panel.background = element_blank(), axis.line = element_line(colour = "black")) + facet_wrap(~ Group)

load(file = "StimLockedN2_Plot_Group.gg")
source("multiplot.R")
multiplot(StimLockedN2_Plot_Group, N2_ParticipantLevelBarPlot_Group, cols = 2)


#Try a boxplot
dateBoxplot <- ggplot(N2_participant_level_long, aes(Hemifield, abs(N2), colour = Hemisphere))
dateBoxplot + geom_boxplot() + facet_wrap(~Group) #+ geom_point( alpha=0.9)


##Check assumptions for  model by plotting residuals:
residuals_N2_Group_by_Hemifield_By_Hemisphere=residuals(N2_Group_by_Hemifield_By_Hemisphere)
plot(residuals_N2_Group_by_Hemifield_By_Hemisphere)
qqnorm(residuals_N2_Group_by_Hemifield_By_Hemisphere)
qqline(residuals_N2_Group_by_Hemifield_By_Hemisphere)
hist(residuals_N2_Group_by_Hemifield_By_Hemisphere)

##Test N2c only
N2c<-N2_participant_level_long[N2_participant_level_long$Hemisphere=="Contralateral",]
N2_random_intercepts_only<-lmer(N2 ~ 1 + (1 | Group/ID) +(1|Hemifield), data = N2c, REML=FALSE, na.action = na.omit)
N2_Group<-update(N2_random_intercepts_only, .~. + Group)
N2_Hemifield<-update(N2_Group, .~. + Hemifield)
N2_Group_by_Hemifield<-update(N2_Hemifield, .~. + Group*Hemifield)

anova(N2_random_intercepts_only, N2_Group, N2_Hemifield, N2_Group_by_Hemifield)

```



#Participant level Pre-target alpha analysis

```{r, message=FALSE}
require(reshape2)
#Reshape data_participant_level into long format for modeling with lmw4:
PreAlpha_participant_level_long <- melt(data_participant_level, id.vars=c("ID", "Gender", "Group", "Age_B", "DAT1_3_Group"), 
                                        measure.vars=c("PreAlpha_LeftHemi", "PreAlpha_RightHemi" ))
require(plyr)
PreAlpha_participant_level_long <-rename(PreAlpha_participant_level_long, c("variable"="Hemisphere", "value"="PreAlpha"))
# Rename factor names 
PreAlpha_participant_level_long$Hemisphere <-revalue(PreAlpha_participant_level_long$Hemisphere, c("PreAlpha_LeftHemi"="Left", "PreAlpha_RightHemi"="Right"))


#Histogram of participant's PreAlpha scores by group and Hemisphere 
PreAlpha_participant_level_long$Hemisphere_By_Group<-interaction(PreAlpha_participant_level_long$Hemisphere, PreAlpha_participant_level_long$Group)
ggplot(PreAlpha_participant_level_long, aes(PreAlpha))  + geom_histogram(aes(y=..count..), colour="black", fill="white") + facet_wrap(~ Hemisphere_By_Group)


hist(PreAlpha_participant_level_long$PreAlpha) #right skewed so use log10(PreAlpha)
hist(log10(PreAlpha_participant_level_long$PreAlpha))


#################################################################
###############Analysis using lmer() - multilevel###############

PreAlpha_random_intercepts_only1<-lmer(log10(PreAlpha) ~ 1 + (1 | Group/ID) +(1|Hemisphere), data = PreAlpha_participant_level_long, REML=FALSE, na.action = na.omit)
PreAlpha_random_intercepts_only<-glmer(PreAlpha ~ 1 + (1 | Group/ID) +(1|Hemisphere), data = PreAlpha_participant_level_long, family = Gamma(link = log), na.action = na.omit)
PreAlpha_Hemisphere<-update(PreAlpha_random_intercepts_only, .~. + Hemisphere)
PreAlpha_Group<-update(PreAlpha_Hemisphere, .~. + Group)
PreAlpha_Hemisphere_By_Group<-update(PreAlpha_Group, .~. + Hemisphere*Group)
anova(PreAlpha_random_intercepts_only, PreAlpha_Hemisphere, PreAlpha_Group, PreAlpha_Hemisphere_By_Group)

#########Break down the signifiant Hemisphere by group interaction in pre-target alpha power

#look at the effect of Hemisphere for ADHD only  - shows no significant hemispheric asymmetry in pre-target alpha in those with ADHD 
summary(glht(lmer(log10(PreAlpha) ~ Hemisphere + (1 | ID) + (1|Hemisphere), data = PreAlpha_participant_level_long[PreAlpha_participant_level_long$Group=="ADHD",], REML=FALSE, na.action = na.omit)))

#look at the effect of Hemisphere for Control only - shows controls had significantly greater right hemisphere pre-target alpha power. THIS MAY BE MODIFIED MY TIME ON TASK THOU. NEED TO DO TRIAL-BY-TRIAL ANALYSIS
summary(glht(lmer(log10(PreAlpha) ~ Hemisphere + (1 | ID) + (1|Hemisphere), data = PreAlpha_participant_level_long[PreAlpha_participant_level_long$Group=="Control",], REML=FALSE, na.action = na.omit)))

#-------Effect Sizes

rcontrast<-function(t, df)
{r<-sqrt(t^2/(t^2 + df))
print(paste("r = ", r))
}

rcontrast(2.8497,  52)


##Check assumptions for  model by plotting residuals:
residuals_PreAlpha_Hemisphere_By_Group=residuals(PreAlpha_Hemisphere_By_Group)
plot(residuals_PreAlpha_Hemisphere_By_Group)
qqnorm(residuals_PreAlpha_Hemisphere_By_Group)
qqline(residuals_PreAlpha_Hemisphere_By_Group)
hist(residuals_PreAlpha_Hemisphere_By_Group)


##############################################################################################################

#################################################################
###############Analysis using classic ANOVA   ###############

PreAlpha_participant_level_long$PreAlpha_log10<-log10(PreAlpha_participant_level_long$PreAlpha)

ezANOVA(data = PreAlpha_participant_level_long, dv = .(PreAlpha_log10), wid = .(ID),  between = .(Group), within = .(Hemisphere), type = 3, detailed = TRUE, return_aov=T)

ezPerm(data = PreAlpha_participant_level_long, dv = .(PreAlpha), wid = .(ID),  between = .(Group), within = .(Hemisphere), perms = 1000)

#Breaking it down with pairwise comparisons:

#The effect of Hemisphere inside ADHD:
t.test(log(data_participant_level$PreAlpha_LeftHemi[data_participant_level$Group=="ADHD"]), log(data_participant_level$PreAlpha_RightHemi[data_participant_level$Group=="ADHD"]), paired=TRUE)

# rcontrast(1,  20)

#The effect of Hemisphere inside Controls: 
d<-t.test(log(data_participant_level$PreAlpha_LeftHemi[data_participant_level$Group=="Control"]), log(data_participant_level$PreAlpha_RightHemi[data_participant_level$Group=="Control"]), paired=TRUE)

# drcontrast(-3,  30)



################################################################







########################Plot the effects############################

source("summarySE.R") 
source("summarySEwithin.R") #function to calculate Std.Er of mean
source("normDataWithin.R")
plotdata <- summarySEwithin(PreAlpha_participant_level_long, measurevar="PreAlpha", withinvars=c("Hemisphere"), betweenvars="Group", idvar="ID")
ggplot(plotdata, aes(x=Group, y=PreAlpha, fill=Hemisphere)) +
    geom_bar(position=position_dodge(.9), colour="Black", stat="identity") + 
    geom_errorbar(position=position_dodge(.9), width=.3, aes(ymin=PreAlpha-se, ymax=PreAlpha+se)) + #can change "se" to "ci" if I want to use 95%ci instead
    geom_hline(yintercept=0) +  coord_cartesian(ylim = c(1, 4)) +
    xlab("Group") + ylab("Pre-target Alpha power (uV)") +
    theme(axis.title.x = element_text(face="bold", size=12),
          axis.text.x  = element_text(face="bold", angle=0,  size=12)) +
    theme(axis.title.y = element_text(face="bold", size=12),
          axis.text.y  = element_text(angle=0, vjust=0.5, size=12)) +
    theme(legend.title = element_text(size=11, face="bold")) +
    theme(legend.text = element_text(size = 11, face = "bold")) +
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), 
          panel.background = element_blank(), axis.line = element_line(colour = "black"))  






```



########################################################################################################################
########################################################################################################################
########################################################################################################################

#Participant level FrontalNeg_slope analysis

```{r, message=FALSE}
#Reshape data_participant_level into long format for modeling with lmw4:
FrontalNeg_slope_participant_level_long <- melt(data_participant_level, id.vars=c("ID", "Gender", "Group", "Age_B", "DAT1_3_Group"), 
                                                measure.vars=c("FrontalNeg_slope_LeftTarget", "FrontalNeg_slope_RightTarget" ), 
                                                variable.name="Hemifield",
                                                value.name="FrontalNeg_slope")

# Rename factor names from "cond1" and "cond2" to "first" and "second"
levels(FrontalNeg_slope_participant_level_long$Hemifield)[levels(FrontalNeg_slope_participant_level_long$Hemifield)=="FrontalNeg_slope_LeftTarget"] <- "Left"
levels(FrontalNeg_slope_participant_level_long$Hemifield)[levels(FrontalNeg_slope_participant_level_long$Hemifield)=="FrontalNeg_slope_RightTarget"] <- "Right"


#Check which participant have invalid FrontalNeg_slope
FrontalNeg_slope_participant_level_long[FrontalNeg_slope_participant_level_long$FrontalNeg_slope>0,]
#Remove CPP slopes of zero as they are not valid
FrontalNeg_slope_participant_level_long<-FrontalNeg_slope_participant_level_long[FrontalNeg_slope_participant_level_long$FrontalNeg_slope<0,]



#Find FrontalNeg_slope Outliers 
FrontalNeg_slope_participant_level_long$FrontalNeg_slope.Z<-scale(FrontalNeg_slope_participant_level_long$FrontalNeg_slope)
#Check which participants have outlier FrontalNeg_slopes
FrontalNeg_slope_participant_level_long[!abs(FrontalNeg_slope_participant_level_long$FrontalNeg_slope.Z)<3,]
#Remove FrontalNeg_slope Outliers 
FrontalNeg_slope_participant_level_long<-FrontalNeg_slope_participant_level_long[abs(FrontalNeg_slope_participant_level_long$FrontalNeg_slope.Z)<3,]

#Histogram of participant's FrontalNeg_slope scores by group and Hemifield 
FrontalNeg_slope_participant_level_long$Hemifield_By_Group<-interaction(FrontalNeg_slope_participant_level_long$Hemifield, FrontalNeg_slope_participant_level_long$Group)
ggplot(FrontalNeg_slope_participant_level_long, aes(FrontalNeg_slope))  + geom_histogram(aes(y=..count..), colour="black", fill="white") + facet_wrap(~ Hemifield_By_Group)



FrontalNeg_slope_random_intercepts_only<-lmer(FrontalNeg_slope ~ 1 + (1 | Group/ID) +(1|Hemifield), data = FrontalNeg_slope_participant_level_long, REML=FALSE, na.action = na.omit)
FrontalNeg_slope_Hemifield<-update(FrontalNeg_slope_random_intercepts_only, .~. + Hemifield)
FrontalNeg_slope_Group<-update(FrontalNeg_slope_Hemifield, .~. + Group)
FrontalNeg_slope_Hemifield_By_Group<-update(FrontalNeg_slope_Group, .~. + Hemifield*Group)
anova(FrontalNeg_slope_random_intercepts_only, FrontalNeg_slope_Hemifield, FrontalNeg_slope_Group, FrontalNeg_slope_Hemifield_By_Group)

require(effects)
plot(allEffects(FrontalNeg_slope_Hemifield_By_Group))


##Check assumptions for  model by plotting residuals:
residuals_FrontalNeg_slope_Hemifield_By_Group=residuals(FrontalNeg_slope_Hemifield_By_Group)
plot(residuals_FrontalNeg_slope_Hemifield_By_Group)
qqnorm(residuals_FrontalNeg_slope_Hemifield_By_Group)
qqline(residuals_FrontalNeg_slope_Hemifield_By_Group)
hist(residuals_FrontalNeg_slope_Hemifield_By_Group)

```





**Add N2c into the model predicting RT, over-and-above the Group by Hemisphere interaction**
    
    ```{r, echo=FALSE, warning=FALSE}

data2<-data[!DF$Blinkneg100_100PR & !DF$LeftFixBreakneg100_100PR & !DF$RightFixBreakneg100_100PR & !DF$Art_neg100_100PR & !DF$BothFixBreakneg100_100PR,]

#####Z-score each participant's N2c data2 ####
data2$IDbyHemifield<-interaction(data2$ID, data2$Hemifield) #ID by Light factor (splits data2 up according to session)
#calculate mean and sd 
m <- tapply(data2$N2c,data2$IDbyHemifield,mean)
s <- sqrt(tapply(data2$N2c,data2$IDbyHemifield,var))
#calculate N2c.Z and save it inside data2.frame
data2$N2c.Z <- (data2$N2c-m[data2$IDbyHemifield])/s[data2$IDbyHemifield]
#check that Z scores have mean=0 and std=1 
N2c.Z_checker <- ddply(data2, c("IDbyHemifield"), summarise,
                       N    = length(N2c.Z ),
                       mean = round(mean(N2c.Z )),
                       sd   = sd(N2c.Z ),
                       se   = sd / sqrt(N))
#Check that the Z scoring worked:
summary(N2c.Z_checker$mean)
summary(N2c.Z_checker$sd)

#Remove outliers:
data2<-data2[!abs(data2$N2c.Z)>3,]

########################### Multi-level Models ########################## 
cat("Number of Observations for modle:")
print(dim(data2)[1])

############ Add N2c into the model predicting RT, over-and-above the Group by Hemisphere interaction ###########
base_model<-lmer(log(RT) ~ 1 + (1 | Group/ID) +(1|ITI) + (1|Hemifield) + (1|Trial), data = data2, REML=F, na.action = na.omit)

RT_N2c<-update(base_model, .~. + N2c)

anova(base_model, RT_N2c)


```




